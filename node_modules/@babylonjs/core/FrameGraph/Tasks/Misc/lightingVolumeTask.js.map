{"version":3,"file":"lightingVolumeTask.js","sourceRoot":"","sources":["../../../../../../dev/core/src/FrameGraph/Tasks/Misc/lightingVolumeTask.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,cAAc,EAAE,0CAAmC;AAC5D,OAAO,EAAE,gBAAgB,EAAE,4CAAqC;AAChE,OAAO,EAAE,cAAc,EAAE,MAAM,sBAAsB,CAAC;AAEtD;;GAEG;AACH,MAAM,OAAO,4BAA6B,SAAQ,cAAc;IAiB5D,IAAoB,IAAI;QACpB,OAAO,IAAI,CAAC,KAAK,CAAC;IACtB,CAAC;IAED,IAAoB,IAAI,CAAC,IAAY;QACjC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAClB,IAAI,IAAI,CAAC,cAAc,EAAE,CAAC;YACtB,IAAI,CAAC,cAAc,CAAC,IAAI,GAAG,IAAI,CAAC;QACpC,CAAC;IACL,CAAC;IAED;;;;OAIG;IACH,YAAY,IAAY,EAAE,UAAsB;QAC5C,KAAK,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC;QAExB,IAAI,CAAC,cAAc,GAAG,IAAI,cAAc,CAAC,IAAI,EAAE,UAAU,CAAC,KAAK,CAAC,CAAC;QAEjE,IAAI,CAAC,wBAAwB,GAAG;YAC5B,MAAM,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC;YAClC,eAAe,EAAE,EAAE;SACtB,CAAC;IACN,CAAC;IAEe,OAAO;QACnB,MAAM,OAAO,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,CAAC;QAC9C,IAAI,OAAO,EAAE,CAAC;YACV,IAAI,CAAC,cAAc,CAAC,yBAAyB,CAAC,IAAI,CAAC,CAAC;QACxD,CAAC;QACD,OAAO,OAAO,CAAC;IACnB,CAAC;IAEe,YAAY;QACxB,OAAO,8BAA8B,CAAC;IAC1C,CAAC;IAEM,MAAM;QACT,IAAI,IAAI,CAAC,eAAe,KAAK,SAAS,EAAE,CAAC;YACrC,MAAM,IAAI,KAAK,CAAC,gCAAgC,IAAI,CAAC,IAAI,+BAA+B,CAAC,CAAC;QAC9F,CAAC;QAED,MAAM,KAAK,GAAG,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC;QAEzC,IAAI,CAAC,CAAC,KAAK,YAAY,gBAAgB,CAAC,EAAE,CAAC;YACvC,MAAM,IAAI,KAAK,CAAC,gCAAgC,IAAI,CAAC,IAAI,qCAAqC,CAAC,CAAC;QACpG,CAAC;QAED,IAAI,CAAC,cAAc,CAAC,eAAe,GAAG,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC;QAE3E,MAAM,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAE3D,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAClD,IAAI,CAAC,cAAc,CAAC,GAAG,EAAE;YACrB,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC;QACjC,CAAC,CAAC,CAAC;QAEH,MAAM,YAAY,GAAG,IAAI,CAAC,WAAW,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,GAAG,WAAW,EAAE,IAAI,CAAC,CAAC;QAEvF,YAAY,CAAC,aAAa,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAC1D,YAAY,CAAC,cAAc,CAAC,GAAG,EAAE,GAAE,CAAC,CAAC,CAAC;IAC1C,CAAC;IAEe,OAAO;QACnB,KAAK,CAAC,OAAO,EAAE,CAAC;QAChB,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,CAAC;IAClC,CAAC;CACJ","sourcesContent":["import type { FrameGraph, FrameGraphObjectList, FrameGraphShadowGeneratorTask } from \"core/index\";\r\nimport { LightingVolume } from \"core/Lights/lightingVolume\";\r\nimport { DirectionalLight } from \"core/Lights/directionalLight\";\r\nimport { FrameGraphTask } from \"../../frameGraphTask\";\r\n\r\n/**\r\n * Task used to create a lighting volume from a directional light's shadow generator.\r\n */\r\nexport class FrameGraphLightingVolumeTask extends FrameGraphTask {\r\n    /**\r\n     * The shadow generator used to create the lighting volume.\r\n     */\r\n    public shadowGenerator: FrameGraphShadowGeneratorTask;\r\n\r\n    /**\r\n     * The output object list containing the lighting volume mesh.\r\n     * You can get the mesh by doing  outputMeshLightingVolume.meshes[0]\r\n     */\r\n    public readonly outputMeshLightingVolume: FrameGraphObjectList;\r\n\r\n    /**\r\n     * The lighting volume created by this task.\r\n     */\r\n    public readonly lightingVolume: LightingVolume;\r\n\r\n    public override get name() {\r\n        return this._name;\r\n    }\r\n\r\n    public override set name(name: string) {\r\n        this._name = name;\r\n        if (this.lightingVolume) {\r\n            this.lightingVolume.name = name;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates a new FrameGraphLightingVolumeTask.\r\n     * @param name Name of the task.\r\n     * @param frameGraph The frame graph instance.\r\n     */\r\n    constructor(name: string, frameGraph: FrameGraph) {\r\n        super(name, frameGraph);\r\n\r\n        this.lightingVolume = new LightingVolume(name, frameGraph.scene);\r\n\r\n        this.outputMeshLightingVolume = {\r\n            meshes: [this.lightingVolume.mesh],\r\n            particleSystems: [],\r\n        };\r\n    }\r\n\r\n    public override isReady() {\r\n        const isReady = this.lightingVolume.isReady();\r\n        if (isReady) {\r\n            this.lightingVolume._setComputeShaderFastMode(true);\r\n        }\r\n        return isReady;\r\n    }\r\n\r\n    public override getClassName(): string {\r\n        return \"FrameGraphLightingVolumeTask\";\r\n    }\r\n\r\n    public record() {\r\n        if (this.shadowGenerator === undefined) {\r\n            throw new Error(`FrameGraphLightingVolumeTask ${this.name}: shadowGenerator is required`);\r\n        }\r\n\r\n        const light = this.shadowGenerator.light;\r\n\r\n        if (!(light instanceof DirectionalLight)) {\r\n            throw new Error(`FrameGraphLightingVolumeTask ${this.name}: light must be a directional light`);\r\n        }\r\n\r\n        this.lightingVolume.shadowGenerator = this.shadowGenerator.shadowGenerator;\r\n\r\n        const pass = this._frameGraph.addObjectListPass(this.name);\r\n\r\n        pass.setObjectList(this.outputMeshLightingVolume);\r\n        pass.setExecuteFunc(() => {\r\n            this.lightingVolume.update();\r\n        });\r\n\r\n        const passDisabled = this._frameGraph.addObjectListPass(this.name + \"_disabled\", true);\r\n\r\n        passDisabled.setObjectList(this.outputMeshLightingVolume);\r\n        passDisabled.setExecuteFunc(() => {});\r\n    }\r\n\r\n    public override dispose() {\r\n        super.dispose();\r\n        this.lightingVolume.dispose();\r\n    }\r\n}\r\n"]}