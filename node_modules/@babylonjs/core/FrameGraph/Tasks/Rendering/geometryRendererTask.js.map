{"version":3,"file":"geometryRendererTask.js","sourceRoot":"","sources":["../../../../../../dev/core/src/FrameGraph/Tasks/Rendering/geometryRendererTask.ts"],"names":[],"mappings":"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","sourcesContent":["import type { FrameGraphTextureHandle, Scene, FrameGraph, AbstractMesh, ObjectRendererOptions, FrameGraphRenderContext, FrameGraphRenderPass, ObjectRenderer } from \"core/index\";\r\nimport { Color4 } from \"core/Maths/math.color\";\r\nimport { MaterialHelperGeometryRendering, GeometryRenderingTextureClearType } from \"core/Materials/materialHelper.geometryrendering\";\r\nimport { Constants } from \"core/Engines/constants\";\r\nimport { FrameGraphObjectRendererTask } from \"./objectRendererTask\";\r\n\r\n/**\r\n * Description of a texture used by the geometry renderer task.\r\n */\r\nexport interface IFrameGraphGeometryRendererTextureDescription {\r\n    /**\r\n     * The type of the texture.\r\n     * The value should be one of the Constants.PREPASS_XXX_TEXTURE_TYPE values.\r\n     */\r\n    type: number;\r\n\r\n    /**\r\n     * The type of the texture.\r\n     */\r\n    textureType: number;\r\n\r\n    /**\r\n     * The format of the texture.\r\n     */\r\n    textureFormat: number;\r\n}\r\n\r\nconst ClearColors: Color4[] = [new Color4(0, 0, 0, 0), new Color4(1, 1, 1, 1), new Color4(0, 0, 0, 0)];\r\n\r\n/**\r\n * Task used to render geometry to a set of textures.\r\n */\r\nexport class FrameGraphGeometryRendererTask extends FrameGraphObjectRendererTask {\r\n    /**\r\n     * The size of the output textures (default is 100% of the back buffer texture size).\r\n     */\r\n    public size: { width: number; height: number } = { width: 100, height: 100 };\r\n\r\n    /**\r\n     * Whether the size is a percentage of the back buffer size (default is true).\r\n     */\r\n    public sizeIsPercentage = true;\r\n\r\n    /**\r\n     * The number of samples to use for the output textures (default is 1).\r\n     */\r\n    public samples = 1;\r\n\r\n    private _reverseCulling = false;\r\n\r\n    /**\r\n     * Whether to reverse culling (default is false).\r\n     */\r\n    public get reverseCulling() {\r\n        return this._reverseCulling;\r\n    }\r\n\r\n    public set reverseCulling(value: boolean) {\r\n        this._reverseCulling = value;\r\n\r\n        const configuration = MaterialHelperGeometryRendering.GetConfiguration(this._renderer.renderPassId);\r\n        if (configuration) {\r\n            configuration.reverseCulling = value;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Indicates if a mesh shouldn't be rendered when its material has depth write disabled (default is true).\r\n     */\r\n    public dontRenderWhenMaterialDepthWriteIsDisabled = true;\r\n\r\n    private _disableDepthPrePass = true;\r\n    /**\r\n     * Indicates whether the depth pre-pass is disabled (default is true).\r\n     * Materials that require depth pre-pass (Material.needDepthPrePass == true) don't work with the geometry renderer, that's why this setting is true by default.\r\n     * However, if the geometry renderer doesn't generate any geometry textures but only renders to the main target texture, then depth pre-pass can be enabled.\r\n     */\r\n    public get disableDepthPrePass() {\r\n        return this._disableDepthPrePass;\r\n    }\r\n\r\n    public set disableDepthPrePass(value: boolean) {\r\n        this._disableDepthPrePass = value;\r\n        this._renderer.disableDepthPrePass = value;\r\n    }\r\n\r\n    /**\r\n     * The list of texture descriptions used by the geometry renderer task.\r\n     */\r\n    public textureDescriptions: IFrameGraphGeometryRendererTextureDescription[] = [];\r\n\r\n    /**\r\n     * The depth (in view space) output texture. Will point to a valid texture only if that texture has been requested in textureDescriptions!\r\n     */\r\n    public readonly geometryViewDepthTexture: FrameGraphTextureHandle;\r\n\r\n    /**\r\n     * The normalized depth (in view space) output texture. Will point to a valid texture only if that texture has been requested in textureDescriptions!\r\n     * The normalization is (d - near) / (far - near), where d is the depth value in view space and near and far are the near and far planes of the camera.\r\n     */\r\n    public readonly geometryNormViewDepthTexture: FrameGraphTextureHandle;\r\n\r\n    /**\r\n     * The depth (in screen space) output texture. Will point to a valid texture only if that texture has been requested in textureDescriptions!\r\n     */\r\n    public readonly geometryScreenDepthTexture: FrameGraphTextureHandle;\r\n\r\n    /**\r\n     * The normal (in view space) output texture. Will point to a valid texture only if that texture has been requested in textureDescriptions!\r\n     */\r\n    public readonly geometryViewNormalTexture: FrameGraphTextureHandle;\r\n\r\n    /**\r\n     * The normal (in world space) output texture. Will point to a valid texture only if that texture has been requested in textureDescriptions!\r\n     */\r\n    public readonly geometryWorldNormalTexture: FrameGraphTextureHandle;\r\n\r\n    /**\r\n     * The position (in local space) output texture. Will point to a valid texture only if that texture has been requested in textureDescriptions!\r\n     */\r\n    public readonly geometryLocalPositionTexture: FrameGraphTextureHandle;\r\n\r\n    /**\r\n     * The position (in world space) output texture. Will point to a valid texture only if that texture has been requested in textureDescriptions!\r\n     */\r\n    public readonly geometryWorldPositionTexture: FrameGraphTextureHandle;\r\n\r\n    /**\r\n     * The albedo output texture. Will point to a valid texture only if that texture has been requested in textureDescriptions!\r\n     */\r\n    public readonly geometryAlbedoTexture: FrameGraphTextureHandle;\r\n\r\n    /**\r\n     * The reflectivity output texture. Will point to a valid texture only if that texture has been requested in textureDescriptions!\r\n     */\r\n    public readonly geometryReflectivityTexture: FrameGraphTextureHandle;\r\n\r\n    /**\r\n     * The velocity output texture. Will point to a valid texture only if that texture has been requested in textureDescriptions!\r\n     */\r\n    public readonly geometryVelocityTexture: FrameGraphTextureHandle;\r\n\r\n    /**\r\n     * The linear velocity output texture. Will point to a valid texture only if that texture has been requested in textureDescriptions!\r\n     */\r\n    public readonly geometryLinearVelocityTexture: FrameGraphTextureHandle;\r\n\r\n    /**\r\n     * Gets or sets the name of the task.\r\n     */\r\n    public override get name() {\r\n        return this._name;\r\n    }\r\n\r\n    public override set name(value: string) {\r\n        this._name = value;\r\n        if (this._renderer) {\r\n            this._renderer.name = value;\r\n        }\r\n    }\r\n\r\n    private _clearAttachmentsLayout: Map<GeometryRenderingTextureClearType, number[]>;\r\n    private _allAttachmentsLayout: number[];\r\n\r\n    /**\r\n     * Constructs a new geometry renderer task.\r\n     * @param name The name of the task.\r\n     * @param frameGraph The frame graph the task belongs to.\r\n     * @param scene The scene the frame graph is associated with.\r\n     * @param options The options of the object renderer.\r\n     * @param existingObjectRenderer An existing object renderer to use (optional). If provided, the options parameter will be ignored.\r\n     */\r\n    constructor(name: string, frameGraph: FrameGraph, scene: Scene, options?: ObjectRendererOptions, existingObjectRenderer?: ObjectRenderer) {\r\n        super(name, frameGraph, scene, options, existingObjectRenderer);\r\n\r\n        this.renderSprites = false;\r\n        this.renderParticles = false;\r\n        this.enableBoundingBoxRendering = false;\r\n        this.enableOutlineRendering = false;\r\n        this._renderer.disableDepthPrePass = true;\r\n\r\n        this._renderer.customIsReadyFunction = (mesh: AbstractMesh, refreshRate: number, preWarm?: boolean) => {\r\n            if (this.dontRenderWhenMaterialDepthWriteIsDisabled && mesh.material && mesh.material.disableDepthWrite) {\r\n                return !!preWarm;\r\n            }\r\n\r\n            return mesh.isReady(refreshRate === 0);\r\n        };\r\n\r\n        this._renderer.onBeforeRenderingManagerRenderObservable.add(() => {\r\n            if (!this._renderer.options.doNotChangeAspectRatio) {\r\n                scene.updateTransformMatrix(true);\r\n            }\r\n        });\r\n\r\n        this._clearAttachmentsLayout = new Map();\r\n        this._allAttachmentsLayout = [];\r\n\r\n        this.geometryViewDepthTexture = this._frameGraph.textureManager.createDanglingHandle();\r\n        this.geometryNormViewDepthTexture = this._frameGraph.textureManager.createDanglingHandle();\r\n        this.geometryScreenDepthTexture = this._frameGraph.textureManager.createDanglingHandle();\r\n        this.geometryViewNormalTexture = this._frameGraph.textureManager.createDanglingHandle();\r\n        this.geometryWorldNormalTexture = this._frameGraph.textureManager.createDanglingHandle();\r\n        this.geometryLocalPositionTexture = this._frameGraph.textureManager.createDanglingHandle();\r\n        this.geometryWorldPositionTexture = this._frameGraph.textureManager.createDanglingHandle();\r\n        this.geometryAlbedoTexture = this._frameGraph.textureManager.createDanglingHandle();\r\n        this.geometryReflectivityTexture = this._frameGraph.textureManager.createDanglingHandle();\r\n        this.geometryVelocityTexture = this._frameGraph.textureManager.createDanglingHandle();\r\n        this.geometryLinearVelocityTexture = this._frameGraph.textureManager.createDanglingHandle();\r\n    }\r\n\r\n    /**\r\n     * Gets the list of excluded meshes from the velocity texture.\r\n     */\r\n    public get excludedSkinnedMeshFromVelocityTexture(): AbstractMesh[] {\r\n        return MaterialHelperGeometryRendering.GetConfiguration(this._renderer.renderPassId).excludedSkinnedMesh;\r\n    }\r\n\r\n    /**\r\n     * Excludes the given skinned mesh from computing bones velocities.\r\n     * Computing bones velocities can have a cost. The cost can be saved by calling this function and by passing the skinned mesh to ignore.\r\n     * @param skinnedMesh The mesh containing the skeleton to ignore when computing the velocity map.\r\n     */\r\n    public excludeSkinnedMeshFromVelocityTexture(skinnedMesh: AbstractMesh): void {\r\n        if (skinnedMesh.skeleton) {\r\n            const list = this.excludedSkinnedMeshFromVelocityTexture;\r\n            if (list.indexOf(skinnedMesh) === -1) {\r\n                list.push(skinnedMesh);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes the given skinned mesh from the excluded meshes to integrate bones velocities while rendering the velocity map.\r\n     * @param skinnedMesh The mesh containing the skeleton that has been ignored previously.\r\n     * @see excludeSkinnedMesh to exclude a skinned mesh from bones velocity computation.\r\n     */\r\n    public removeExcludedSkinnedMeshFromVelocityTexture(skinnedMesh: AbstractMesh): void {\r\n        const list = this.excludedSkinnedMeshFromVelocityTexture;\r\n        const index = list.indexOf(skinnedMesh);\r\n        if (index !== -1) {\r\n            list.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    public override getClassName(): string {\r\n        return \"FrameGraphGeometryRendererTask\";\r\n    }\r\n\r\n    public override record(skipCreationOfDisabledPasses = false, additionalExecute?: (context: FrameGraphRenderContext) => void): FrameGraphRenderPass {\r\n        this._buildClearAttachmentsLayout();\r\n\r\n        this._registerForRenderPassId(this._renderer.renderPassId);\r\n\r\n        MaterialHelperGeometryRendering.MarkAsDirty(this._renderer.renderPassId, this.objectList.meshes || this._scene.meshes);\r\n\r\n        const pass = super.record(skipCreationOfDisabledPasses, additionalExecute) as FrameGraphRenderPass;\r\n\r\n        const outputTextureHandles = pass.renderTarget as FrameGraphTextureHandle[];\r\n\r\n        let needPreviousWorldMatrices = false;\r\n\r\n        for (let i = 0; i < this.textureDescriptions.length; i++) {\r\n            const description = this.textureDescriptions[i];\r\n            const handle = outputTextureHandles[i];\r\n            const index = MaterialHelperGeometryRendering.GeometryTextureDescriptions.findIndex((f) => f.type === description.type);\r\n            const geometryDescription = MaterialHelperGeometryRendering.GeometryTextureDescriptions[index];\r\n\r\n            switch (geometryDescription.type) {\r\n                case Constants.PREPASS_DEPTH_TEXTURE_TYPE:\r\n                    this._frameGraph.textureManager.resolveDanglingHandle(this.geometryViewDepthTexture, handle);\r\n                    break;\r\n                case Constants.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE:\r\n                    this._frameGraph.textureManager.resolveDanglingHandle(this.geometryNormViewDepthTexture, handle);\r\n                    break;\r\n                case Constants.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE:\r\n                    this._frameGraph.textureManager.resolveDanglingHandle(this.geometryScreenDepthTexture, handle);\r\n                    break;\r\n                case Constants.PREPASS_NORMAL_TEXTURE_TYPE:\r\n                    this._frameGraph.textureManager.resolveDanglingHandle(this.geometryViewNormalTexture, handle);\r\n                    break;\r\n                case Constants.PREPASS_WORLD_NORMAL_TEXTURE_TYPE:\r\n                    this._frameGraph.textureManager.resolveDanglingHandle(this.geometryWorldNormalTexture, handle);\r\n                    break;\r\n                case Constants.PREPASS_LOCAL_POSITION_TEXTURE_TYPE:\r\n                    this._frameGraph.textureManager.resolveDanglingHandle(this.geometryLocalPositionTexture, handle);\r\n                    break;\r\n                case Constants.PREPASS_POSITION_TEXTURE_TYPE:\r\n                    this._frameGraph.textureManager.resolveDanglingHandle(this.geometryWorldPositionTexture, handle);\r\n                    break;\r\n                case Constants.PREPASS_ALBEDO_TEXTURE_TYPE:\r\n                    this._frameGraph.textureManager.resolveDanglingHandle(this.geometryAlbedoTexture, handle);\r\n                    break;\r\n                case Constants.PREPASS_REFLECTIVITY_TEXTURE_TYPE:\r\n                    this._frameGraph.textureManager.resolveDanglingHandle(this.geometryReflectivityTexture, handle);\r\n                    break;\r\n                case Constants.PREPASS_VELOCITY_TEXTURE_TYPE:\r\n                    this._frameGraph.textureManager.resolveDanglingHandle(this.geometryVelocityTexture, handle);\r\n                    needPreviousWorldMatrices = true;\r\n                    break;\r\n                case Constants.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE:\r\n                    this._frameGraph.textureManager.resolveDanglingHandle(this.geometryLinearVelocityTexture, handle);\r\n                    needPreviousWorldMatrices = true;\r\n                    break;\r\n            }\r\n        }\r\n\r\n        this._scene.needsPreviousWorldMatrices = needPreviousWorldMatrices;\r\n\r\n        return pass;\r\n    }\r\n\r\n    public override dispose(): void {\r\n        MaterialHelperGeometryRendering.DeleteConfiguration(this._renderer.renderPassId);\r\n        this._renderer.dispose();\r\n        super.dispose();\r\n    }\r\n\r\n    protected override _resolveDanglingHandles(_targetTextures: FrameGraphTextureHandle[]) {\r\n        if (this.targetTexture !== undefined) {\r\n            this._frameGraph.textureManager.resolveDanglingHandle(this.outputTexture, Array.isArray(this.targetTexture) ? this.targetTexture[0] : this.targetTexture);\r\n        }\r\n\r\n        if (this.depthTexture !== undefined) {\r\n            this._frameGraph.textureManager.resolveDanglingHandle(this.outputDepthTexture, this.depthTexture);\r\n        }\r\n    }\r\n\r\n    protected override _checkParameters() {\r\n        if (this.objectList === undefined || this.camera === undefined) {\r\n            throw new Error(`FrameGraphGeometryRendererTask ${this.name}: object list and camera must be provided`);\r\n        }\r\n    }\r\n\r\n    protected override _checkTextureCompatibility(targetTextures: FrameGraphTextureHandle[]): boolean {\r\n        let depthEnabled = false;\r\n\r\n        let dimensions: { width: number; height: number } | null = null;\r\n\r\n        if (this.targetTexture !== undefined) {\r\n            const outputTextureDescription = this._frameGraph.textureManager.getTextureDescription(Array.isArray(this.targetTexture) ? this.targetTexture[0] : this.targetTexture);\r\n            if (this.samples !== outputTextureDescription.options.samples) {\r\n                throw new Error(`FrameGraphGeometryRendererTask ${this.name}: the target texture and the output geometry textures  must have the same number of samples`);\r\n            }\r\n            dimensions = outputTextureDescription.size;\r\n        }\r\n\r\n        if (this.depthTexture !== undefined) {\r\n            const depthTextureDescription = this._frameGraph.textureManager.getTextureDescription(this.depthTexture);\r\n            if (depthTextureDescription.options.samples !== this.samples && this.textureDescriptions.length > 0) {\r\n                throw new Error(`FrameGraphGeometryRendererTask ${this.name}: the depth texture and the output geometry textures must have the same number of samples`);\r\n            }\r\n\r\n            this._frameGraph.textureManager.resolveDanglingHandle(this.outputDepthTexture, this.depthTexture);\r\n\r\n            depthEnabled = true;\r\n            dimensions = depthTextureDescription.size;\r\n        }\r\n\r\n        const geomTextureDimensions = this.sizeIsPercentage ? this._frameGraph.textureManager.getAbsoluteDimensions(this.size) : this.size;\r\n        if (dimensions !== null) {\r\n            if (geomTextureDimensions.width !== dimensions.width || geomTextureDimensions.height !== dimensions.height) {\r\n                throw new Error(\r\n                    `FrameGraphGeometryRendererTask ${this.name}: the geometry textures (size: ${geomTextureDimensions.width}x${geomTextureDimensions.height}) and the target/depth texture (size: ${dimensions.width}x${dimensions.height}) must have the same dimensions.`\r\n                );\r\n            }\r\n        }\r\n\r\n        depthEnabled = depthEnabled || super._checkTextureCompatibility(targetTextures);\r\n\r\n        return depthEnabled;\r\n    }\r\n\r\n    protected override _getTargetHandles(): FrameGraphTextureHandle[] {\r\n        const types: number[] = [];\r\n        const formats: number[] = [];\r\n        const labels: string[] = [];\r\n        const useSRGBBuffers: boolean[] = [];\r\n\r\n        for (let i = 0; i < this.textureDescriptions.length; i++) {\r\n            const description = this.textureDescriptions[i];\r\n            const index = MaterialHelperGeometryRendering.GeometryTextureDescriptions.findIndex((f) => f.type === description.type);\r\n\r\n            if (index === -1) {\r\n                throw new Error(`FrameGraphGeometryRendererTask ${this.name}: unknown texture type ${description.type}`);\r\n            }\r\n\r\n            types[i] = description.textureType;\r\n            formats[i] = description.textureFormat;\r\n            labels[i] = MaterialHelperGeometryRendering.GeometryTextureDescriptions[index].name;\r\n            useSRGBBuffers[i] = false;\r\n        }\r\n\r\n        const handles: FrameGraphTextureHandle[] = [];\r\n\r\n        if (this.textureDescriptions.length > 0) {\r\n            const baseHandle = this._frameGraph.textureManager.createRenderTargetTexture(this.name, {\r\n                size: this.size,\r\n                sizeIsPercentage: this.sizeIsPercentage,\r\n                options: {\r\n                    createMipMaps: false,\r\n                    samples: this.samples,\r\n                    types,\r\n                    formats,\r\n                    useSRGBBuffers,\r\n                    labels,\r\n                },\r\n            });\r\n\r\n            for (let i = 0; i < this.textureDescriptions.length; i++) {\r\n                handles.push(baseHandle + i);\r\n            }\r\n        }\r\n\r\n        if (this.targetTexture !== undefined) {\r\n            if (Array.isArray(this.targetTexture)) {\r\n                handles.push(...this.targetTexture);\r\n            } else {\r\n                handles.push(this.targetTexture);\r\n            }\r\n        }\r\n\r\n        return handles;\r\n    }\r\n\r\n    protected override _prepareRendering(context: FrameGraphRenderContext, depthEnabled: boolean) {\r\n        context.setDepthStates(this.depthTest && depthEnabled, this.depthWrite && depthEnabled);\r\n\r\n        context.pushDebugGroup(`Clear attachments`);\r\n\r\n        this._clearAttachmentsLayout.forEach((layout, clearType) => {\r\n            context.clearColorAttachments(ClearColors[clearType], layout);\r\n        });\r\n\r\n        context.restoreDefaultFramebuffer();\r\n        context.popDebugGroup();\r\n\r\n        return this._allAttachmentsLayout;\r\n    }\r\n\r\n    private _buildClearAttachmentsLayout() {\r\n        const clearAttachmentsLayout = new Map<GeometryRenderingTextureClearType, boolean[]>();\r\n        const allAttachmentsLayout: boolean[] = [];\r\n\r\n        for (let i = 0; i < this.textureDescriptions.length; i++) {\r\n            const description = this.textureDescriptions[i];\r\n            const index = MaterialHelperGeometryRendering.GeometryTextureDescriptions.findIndex((f) => f.type === description.type);\r\n            const geometryDescription = MaterialHelperGeometryRendering.GeometryTextureDescriptions[index];\r\n\r\n            let layout = clearAttachmentsLayout.get(geometryDescription.clearType);\r\n            if (layout === undefined) {\r\n                layout = [];\r\n                clearAttachmentsLayout.set(geometryDescription.clearType, layout);\r\n                for (let j = 0; j < i; j++) {\r\n                    layout[j] = false;\r\n                }\r\n            }\r\n\r\n            clearAttachmentsLayout.forEach((layout, clearType) => {\r\n                layout.push(clearType === geometryDescription.clearType);\r\n            });\r\n\r\n            allAttachmentsLayout.push(true);\r\n        }\r\n\r\n        if (this.targetTexture !== undefined) {\r\n            // We don't clear the target texture, but we need to add a layout for it in clearAttachmentsLayout to be able to use clearColorAttachments with the correct number of attachments in _prepareRendering.\r\n            // We also need to add a value in allAttachmentsLayout for the target texture.\r\n            let layout = clearAttachmentsLayout.get(GeometryRenderingTextureClearType.Zero);\r\n            if (layout === undefined) {\r\n                layout = [];\r\n                clearAttachmentsLayout.set(GeometryRenderingTextureClearType.Zero, layout);\r\n                for (let j = 0; j < this.textureDescriptions.length - 1; j++) {\r\n                    layout[j] = false;\r\n                }\r\n            }\r\n\r\n            clearAttachmentsLayout.forEach((layout) => {\r\n                layout.push(false);\r\n            });\r\n\r\n            allAttachmentsLayout.push(true);\r\n        }\r\n\r\n        this._clearAttachmentsLayout = new Map();\r\n\r\n        clearAttachmentsLayout.forEach((layout, clearType) => {\r\n            this._clearAttachmentsLayout.set(clearType, this._engine.buildTextureLayout(layout));\r\n        });\r\n\r\n        this._allAttachmentsLayout = this._engine.buildTextureLayout(allAttachmentsLayout);\r\n    }\r\n\r\n    private _registerForRenderPassId(renderPassId: number) {\r\n        const configuration = MaterialHelperGeometryRendering.CreateConfiguration(renderPassId);\r\n\r\n        for (let i = 0; i < this.textureDescriptions.length; i++) {\r\n            const description = this.textureDescriptions[i];\r\n            const index = MaterialHelperGeometryRendering.GeometryTextureDescriptions.findIndex((f) => f.type === description.type);\r\n            const geometryDescription = MaterialHelperGeometryRendering.GeometryTextureDescriptions[index];\r\n\r\n            configuration.defines[geometryDescription.defineIndex] = i;\r\n        }\r\n\r\n        if (this.targetTexture !== undefined) {\r\n            configuration.defines[\"PREPASS_COLOR_INDEX\"] = this.textureDescriptions.length;\r\n        }\r\n\r\n        configuration.reverseCulling = this.reverseCulling;\r\n    }\r\n}\r\n"]}