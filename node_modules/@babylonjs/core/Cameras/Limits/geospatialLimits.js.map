{"version":3,"file":"geospatialLimits.js","sourceRoot":"","sources":["../../../../../dev/core/src/Cameras/Limits/geospatialLimits.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,OAAO,EAAE,MAAM,4BAA4B,CAAC;AACrD,OAAO,EAAE,OAAO,EAAE,MAAM,yBAAyB,CAAC;AAClD,OAAO,EAAE,KAAK,EAAE,MAAM,mCAAmC,CAAC;AAC1D;;GAEG;AACH,MAAM,OAAO,gBAAgB;IAyBzB;;OAEG;IACH,YAAY,YAAoB;QA1BxB,eAAU,GAAW,EAAE,CAAC;QACxB,eAAU,GAAW,QAAQ,CAAC;QAEtC,mGAAmG;QAC5F,aAAQ,GAAW,OAAO,CAAC;QAElC,0FAA0F;QACnF,aAAQ,GAAW,IAAI,CAAC,EAAE,GAAG,CAAC,GAAG,IAAI,CAAC;QAE7C;;;;;WAKG;QACI,6BAAwB,GAAa,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAE9D,2DAA2D;QACpD,WAAM,GAAW,CAAC,QAAQ,CAAC;QAElC,2DAA2D;QACpD,WAAM,GAAW,QAAQ,CAAC;QAM7B,IAAI,CAAC,aAAa,GAAG,YAAY,CAAC;QAClC,IAAI,CAAC,SAAS,GAAG,YAAY,GAAG,CAAC,CAAC;IACtC,CAAC;IAED,IAAW,SAAS;QAChB,OAAO,IAAI,CAAC,UAAU,CAAC;IAC3B,CAAC;IAED;;OAEG;IACH,IAAW,SAAS,CAAC,KAAa;QAC9B,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;IAC5B,CAAC;IAED,IAAW,SAAS;QAChB,OAAO,IAAI,CAAC,UAAU,CAAC;IAC3B,CAAC;IAED;;OAEG;IACH,IAAW,SAAS,CAAC,KAAa;QAC9B,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;IAC5B,CAAC;IAED;;OAEG;IACH,IAAW,YAAY;QACnB,OAAO,IAAI,CAAC,aAAa,CAAC;IAC9B,CAAC;IAED,wFAAwF;IACxF,IAAW,YAAY,CAAC,KAAa;QACjC,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;IAC/B,CAAC;IAED;;;;;;OAMG;IACI,iBAAiB,CAAC,YAAoB,EAAE,aAAqB,EAAE,gBAAyB;QAC3F,IAAI,YAAY,GAAG,CAAC,EAAE,CAAC;YACnB,8DAA8D;YAC9D,MAAM,SAAS,GAAG,CAAC,gBAAgB,IAAI,aAAa,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC;YACxE,OAAO,IAAI,CAAC,GAAG,CAAC,YAAY,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC,CAAC;QAC1D,CAAC;aAAM,CAAC;YACJ,uCAAuC;YACvC,MAAM,UAAU,GAAG,IAAI,CAAC,UAAU,GAAG,aAAa,CAAC;YACnD,OAAO,IAAI,CAAC,GAAG,CAAC,YAAY,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC,CAAC;QAC5D,CAAC;IACL,CAAC;IAED;;;;;;OAMG;IACI,oBAAoB,CAAC,aAAqB;QAC7C,IAAI,CAAC,IAAI,CAAC,wBAAwB,EAAE,CAAC;YACjC,OAAO,IAAI,CAAC,QAAQ,CAAC;QACzB,CAAC;QAED,MAAM,eAAe,GAAG,IAAI,CAAC,wBAAwB,CAAC,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC;QAC7E,MAAM,aAAa,GAAG,IAAI,CAAC,wBAAwB,CAAC,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC;QAE3E,IAAI,aAAa,IAAI,eAAe,EAAE,CAAC;YACnC,qBAAqB;YACrB,OAAO,IAAI,CAAC,QAAQ,CAAC;QACzB,CAAC;aAAM,IAAI,aAAa,IAAI,aAAa,EAAE,CAAC;YACxC,mBAAmB;YACnB,OAAO,IAAI,CAAC,QAAQ,CAAC;QACzB,CAAC;aAAM,CAAC;YACJ,4CAA4C;YAC5C,MAAM,CAAC,GAAG,CAAC,aAAa,GAAG,eAAe,CAAC,GAAG,CAAC,aAAa,GAAG,eAAe,CAAC,CAAC;YAChF,MAAM,QAAQ,GAAG,KAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YAChC,OAAO,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC,GAAG,QAAQ,CAAC,GAAG,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACrE,CAAC;IACL,CAAC;CACJ","sourcesContent":["import { Epsilon } from \"../../Maths/math.constants\";\r\nimport { Vector2 } from \"../../Maths/math.vector\";\r\nimport { Clamp } from \"../../Maths/math.scalar.functions\";\r\n/**\r\n * Limits for geospatial camera\r\n */\r\nexport class GeospatialLimits {\r\n    private _planetRadius: number;\r\n    private _radiusMin: number = 10;\r\n    private _radiusMax: number = Infinity;\r\n\r\n    /** Gets the minimum pitch angle (angle from horizon) -- 0 means looking straight down at planet */\r\n    public pitchMin: number = Epsilon;\r\n\r\n    /**  Gets the maximum pitch angle (angle from horizon) -- Pi/2 means looking at horizon */\r\n    public pitchMax: number = Math.PI / 2 - 0.01;\r\n\r\n    /**\r\n     * Controls how pitch is disabled as the camera zooms out.\r\n     * x = radius scale at which full pitch is allowed (e.g., 1.5 means 1.5 * planetRadius)\r\n     * y = radius scale at which pitch is fully disabled (forced to pitchMin)\r\n     * Set to undefined to disable this feature.\r\n     */\r\n    public pitchDisabledRadiusScale?: Vector2 = new Vector2(2, 4);\r\n\r\n    /** Gets the minimum yaw angle (rotation around up axis) */\r\n    public yawMin: number = -Infinity;\r\n\r\n    /** Gets the maximum yaw angle (rotation around up axis) */\r\n    public yawMax: number = Infinity;\r\n\r\n    /**\r\n     * @param planetRadius The radius of the planet\r\n     */\r\n    constructor(planetRadius: number) {\r\n        this._planetRadius = planetRadius;\r\n        this.radiusMax = planetRadius * 4;\r\n    }\r\n\r\n    public get radiusMin(): number {\r\n        return this._radiusMin;\r\n    }\r\n\r\n    /**\r\n     * Sets the minimum radius\r\n     */\r\n    public set radiusMin(value: number) {\r\n        this._radiusMin = value;\r\n    }\r\n\r\n    public get radiusMax(): number {\r\n        return this._radiusMax;\r\n    }\r\n\r\n    /**\r\n     * Sets the maximum radius\r\n     */\r\n    public set radiusMax(value: number) {\r\n        this._radiusMax = value;\r\n    }\r\n\r\n    /**\r\n     * Gets the planet radius used for altitude/radius conversions\r\n     */\r\n    public get planetRadius(): number {\r\n        return this._planetRadius;\r\n    }\r\n\r\n    /** Sets the planet radius and updates the radius limits to maintain current altitude */\r\n    public set planetRadius(value: number) {\r\n        this._planetRadius = value;\r\n    }\r\n\r\n    /**\r\n     * Clamps a zoom distance to respect the radius limits.\r\n     * @param zoomDistance The requested zoom distance (positive = zoom in, negative = zoom out)\r\n     * @param currentRadius The current camera radius\r\n     * @param distanceToTarget Optional distance to the zoom target point (used for zoom-in clamping)\r\n     * @returns The clamped zoom distance\r\n     */\r\n    public clampZoomDistance(zoomDistance: number, currentRadius: number, distanceToTarget?: number): number {\r\n        if (zoomDistance > 0) {\r\n            // Zooming IN - don't zoom past the surface or below radiusMin\r\n            const maxZoomIn = (distanceToTarget ?? currentRadius) - this._radiusMin;\r\n            return Math.min(zoomDistance, Math.max(0, maxZoomIn));\r\n        } else {\r\n            // Zooming OUT - don't exceed radiusMax\r\n            const maxZoomOut = this._radiusMax - currentRadius;\r\n            return Math.max(zoomDistance, -Math.max(0, maxZoomOut));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Computes the effective maximum pitch based on the current camera radius.\r\n     * When pitchDisabledRadiusScale is set, pitch is interpolated from pitchMax to pitchMin\r\n     * as the camera zooms out from x*planetRadius to y*planetRadius.\r\n     * @param currentRadius The current camera radius\r\n     * @returns The effective maximum pitch angle\r\n     */\r\n    public getEffectivePitchMax(currentRadius: number): number {\r\n        if (!this.pitchDisabledRadiusScale) {\r\n            return this.pitchMax;\r\n        }\r\n\r\n        const fullPitchRadius = this.pitchDisabledRadiusScale.x * this._planetRadius;\r\n        const noPitchRadius = this.pitchDisabledRadiusScale.y * this._planetRadius;\r\n\r\n        if (currentRadius <= fullPitchRadius) {\r\n            // Full pitch allowed\r\n            return this.pitchMax;\r\n        } else if (currentRadius >= noPitchRadius) {\r\n            // No pitch allowed\r\n            return this.pitchMin;\r\n        } else {\r\n            // Interpolate between pitchMax and pitchMin\r\n            const t = (currentRadius - fullPitchRadius) / (noPitchRadius - fullPitchRadius);\r\n            const clampedT = Clamp(t, 0, 1);\r\n            return this.pitchMax * (1 - clampedT) + this.pitchMin * clampedT;\r\n        }\r\n    }\r\n}\r\n"]}