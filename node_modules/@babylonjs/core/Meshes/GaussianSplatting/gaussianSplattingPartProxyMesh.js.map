{"version":3,"file":"gaussianSplattingPartProxyMesh.js","sourceRoot":"","sources":["../../../../../dev/core/src/Meshes/GaussianSplatting/gaussianSplattingPartProxyMesh.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Nullable } from \"core/types\";\r\nimport type { Scene } from \"core/scene\";\r\nimport { Mesh } from \"../mesh\";\r\nimport { BoundingInfo } from \"../../Culling/boundingInfo\";\r\nimport type { GaussianSplattingMesh } from \"./gaussianSplattingMesh\";\r\nimport type { Ray } from \"../../Culling/ray.core\";\r\nimport { PickingInfo } from \"../../Collisions/pickingInfo\";\r\nimport { Vector3 } from \"../../Maths/math.vector\";\r\n\r\n/**\r\n * Class used as a proxy mesh for a part of a compound Gaussian Splatting mesh\r\n */\r\nexport class GaussianSplattingPartProxyMesh extends Mesh {\r\n    /**\r\n     * The Gaussian Splatting mesh that this proxy represents a part of\r\n     */\r\n    public readonly proxiedMesh: GaussianSplattingMesh;\r\n\r\n    /**\r\n     * The index of the part in the compound mesh (internal storage)\r\n     */\r\n    private _partIndex: number;\r\n\r\n    /**\r\n     * Gets the index of the part in the compound mesh\r\n     */\r\n    public get partIndex(): number {\r\n        return this._partIndex;\r\n    }\r\n\r\n    /**\r\n     * The original Gaussian Splatting mesh that was merged into the compound\r\n     */\r\n    public readonly compoundSplatMesh: GaussianSplattingMesh;\r\n\r\n    /**\r\n     * Creates a new Gaussian Splatting part proxy mesh\r\n     * @param name The name of the proxy mesh\r\n     * @param scene The scene the proxy mesh belongs to\r\n     * @param compoundSplatMesh The original Gaussian Splatting mesh that was merged into the compound\r\n     * @param proxiedMesh The Gaussian Splatting mesh that this proxy represents a part of\r\n     * @param partIndex The index of the part in the compound mesh\r\n     */\r\n    constructor(name: string, scene: Nullable<Scene>, compoundSplatMesh: GaussianSplattingMesh, proxiedMesh: GaussianSplattingMesh, partIndex: number) {\r\n        super(name, scene);\r\n        this.proxiedMesh = proxiedMesh;\r\n        this._partIndex = partIndex;\r\n        this.compoundSplatMesh = compoundSplatMesh;\r\n\r\n        // Set bounding info based on the source mesh's bounds\r\n        this.updateBoundingInfoFromProxiedMesh();\r\n        this.compoundSplatMesh.setWorldMatrixForPart(this.partIndex, this.getWorldMatrix());\r\n\r\n        // Update the proxied mesh's part matrix when this proxy's world matrix changes\r\n        this.onAfterWorldMatrixUpdateObservable.add(() => {\r\n            this.compoundSplatMesh.setWorldMatrixForPart(this.partIndex, this.getWorldMatrix());\r\n            this.updateBoundingInfoFromProxiedMesh();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Updates the bounding info of this proxy mesh from the proxied mesh\r\n     */\r\n    public updateBoundingInfoFromProxiedMesh(): void {\r\n        const boundingInfo = this.proxiedMesh.getBoundingInfo();\r\n        this.setBoundingInfo(new BoundingInfo(boundingInfo.minimum.clone(), boundingInfo.maximum.clone()));\r\n    }\r\n\r\n    /**\r\n     * Returns the class name\r\n     * @returns \"GaussianSplattingPartProxyMesh\"\r\n     */\r\n    public override getClassName(): string {\r\n        return \"GaussianSplattingPartProxyMesh\";\r\n    }\r\n\r\n    /**\r\n     * Updates the part index for this proxy mesh.\r\n     * This should only be called internally when parts are removed from the compound mesh.\r\n     * @param newPartIndex the new part index\r\n     * @internal\r\n     */\r\n    public updatePartIndex(newPartIndex: number): void {\r\n        this._partIndex = newPartIndex;\r\n    }\r\n\r\n    /**\r\n     * Gets whether the part is visible\r\n     */\r\n    public override get isVisible(): boolean {\r\n        return this.compoundSplatMesh.getPartVisibility(this.partIndex) > 0;\r\n    }\r\n\r\n    /**\r\n     * Sets whether the part is visible\r\n     */\r\n    public override set isVisible(value: boolean) {\r\n        this.compoundSplatMesh.setPartVisibility(this.partIndex, value ? 1.0 : 0.0);\r\n    }\r\n\r\n    /**\r\n     * Gets the visibility of the part (0.0 to 1.0)\r\n     */\r\n    public override get visibility(): number {\r\n        return this.compoundSplatMesh.getPartVisibility(this.partIndex);\r\n    }\r\n\r\n    /**\r\n     * Sets the visibility of the part (0.0 to 1.0)\r\n     */\r\n    public override set visibility(value: number) {\r\n        this.compoundSplatMesh.setPartVisibility(this.partIndex, value);\r\n    }\r\n\r\n    /**\r\n     * Checks if a ray intersects with this proxy mesh using only bounding info\r\n     * @param ray defines the ray to test\r\n     * @returns the picking info with this mesh set as pickedMesh if hit\r\n     */\r\n    public override intersects(ray: Ray): PickingInfo {\r\n        const pickingInfo = new PickingInfo();\r\n        const boundingInfo = this.getBoundingInfo();\r\n\r\n        if (!boundingInfo) {\r\n            return pickingInfo;\r\n        }\r\n\r\n        // Always check against bounding info for proxy meshes\r\n        if (!ray.intersectsSphere(boundingInfo.boundingSphere) || !ray.intersectsBox(boundingInfo.boundingBox)) {\r\n            return pickingInfo;\r\n        }\r\n\r\n        // If we hit the bounding volume, report this mesh as picked\r\n        pickingInfo.hit = true;\r\n        pickingInfo.pickedMesh = this;\r\n        pickingInfo.distance = Vector3.Distance(ray.origin, boundingInfo.boundingSphere.center);\r\n        pickingInfo.subMeshId = 0;\r\n\r\n        return pickingInfo;\r\n    }\r\n}\r\n"]}